#!/usr/bin/env bash

{{ if eq .chezmoi.os "linux" }}

  {{ if eq .chezmoi.osRelease.id "ubuntu" }}

    ############################################################
    # install Oh My Zsh                                        #
    ############################################################

    echo "Installing Oh My Zsh..."

    if [ -d "$HOME/.oh-my-zsh" ]; then
      echo "Oh My Zsh already exists, skipping installation."
    else
      git clone https://github.com/ohmyzsh/ohmyzsh.git "$HOME/.oh-my-zsh"
      echo "✅ Oh My Zsh installed"
    fi


    ############################################################
    # install Oh My Zsh plugins                                #
    ############################################################

    echo "Installing Oh My Zsh plugins..."

    PLUGINS_DIR="$HOME/.oh-my-zsh/custom/plugins"
    mkdir -p "$PLUGINS_DIR"

    declare -A PLUGINS=(
      [zsh-syntax-highlighting]="https://github.com/zsh-users/zsh-syntax-highlighting.git"
      [zsh-completions]="https://github.com/zsh-users/zsh-completions.git"
      [zsh-autosuggestions]="https://github.com/zsh-users/zsh-autosuggestions.git"
      [zsh-history-substring-search]="https://github.com/zsh-users/zsh-history-substring-search.git"
    )

    for plugin in "${!PLUGINS[@]}"; do
      plugin_path="$PLUGINS_DIR/$plugin"
      if [ -d "$plugin_path" ]; then
        echo "Plugin $plugin already exists, skipping."
      else
        git clone "${PLUGINS[$plugin]}" "$plugin_path"
        echo "✅ $plugin installed"
      fi
    done


    ############################################################
    # set default shell to zsh                                 #
    ############################################################

    echo "Setting default shell to zsh..."

    ZSH_PATH=$(command -v zsh)
    if [ -n "$ZSH_PATH" ]; then
      if [ "$SHELL" != "$ZSH_PATH" ]; then
        echo "Changing default shell to zsh..."
        chsh -s "$ZSH_PATH"
        echo "✅ Default shell changed to zsh"
        echo "Note: Please log out and log back in for the change to take effect."
      else
        echo "Default shell is already zsh."
      fi
    else
      echo "⚠️  zsh not found, skipping default shell change."
    fi

  {{ end }}

{{ end }}

